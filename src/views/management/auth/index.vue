<template>
  <n-p>你选中了 {{ checkedRowKeys.length }} 行。</n-p>
  <n-button type="error" @click="data.pop()">pop</n-button>
  <n-data-table
    :columns="columns"
    :data="data"
    :pagination="pagination"
    :row-key="rowKey"
    :default-checked-row-keys="[8, 9]"
    @update:checked-row-keys="handleCheck"
  />
</template>

<script lang="ts">
import { defineComponent, ref } from 'vue';
import type { DataTableColumns, DataTableRowKey } from 'naive-ui';

type RowData = {
  key: number;
  name: string;
  age: string;
  address: string;
};

const createColumns = (): DataTableColumns<RowData> => [
  {
    type: 'selection',
    disabled(row: RowData) {
      return row.name === 'Edward King 3';
    }
  },
  {
    title: 'Name',
    key: 'name'
  },
  {
    title: 'Age',
    key: 'age'
  },
  {
    title: 'Address',
    key: 'address'
  }
];

const data = ref(
  Array.from({ length: 10 }).map((_, index) => ({
    name: `Edward King ${index}`,
    age: 32,
    key: index,
    address: `London, Park Lane no. ${index}`
  }))
);

export default defineComponent({
  setup() {
    const checkedRowKeysRef = ref<DataTableRowKey[]>([]);

    return {
      data,
      columns: createColumns(),
      checkedRowKeys: checkedRowKeysRef,
      pagination: {
        pageSize: 20
      },
      rowKey: (row: RowData) => row.key,
      handleCheck(rowKeys: DataTableRowKey[]) {
        checkedRowKeysRef.value = rowKeys;
      }
    };
  }
});
</script>
